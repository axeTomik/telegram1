<!DOCTYPE html>
<html>
<head>
    <title>BeautyBook</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loader"></div>
        <div id="status">Идет авторизация...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const backendUrl = 'http://localhost:8000';  # Локальный адрес бэкенда
        
        async function initApp() {
            try {
                // Получение параметров из URL
                const urlParams = new URLSearchParams(window.location.search);
                const initData = urlParams.get('initData');
                const hash = urlParams.get('hash');

                // Отправка запроса на бэкенд
                const response = await fetch(`${backendUrl}/api/auth`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ init_data: initData, hash: hash })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Обновление интерфейса
                document.getElementById('app').innerHTML = `
                    <h1>Добро пожаловать, пользователь #${data.user_id}!</h1>
                    <!-- Основной интерфейс -->
                `;
                
                tg.MainButton.show().setText('Мой профиль');
                
            } catch (error) {
                document.getElementById('status').textContent = 'Ошибка авторизации!';
                tg.showAlert(error.message);
                tg.close();
            }
        }

        // Инициализация при загрузке
        tg.ready();
        initApp();
    </script>
</body>
</html>
