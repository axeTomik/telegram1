<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BeautyBook</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #007bff;
            --secondary: #6c757d;
            --light: #f8f9fa;
            --dark: #343a40;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--light);
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .active {
            display: block !important;
        }

        .header {
            text-align: center;
            margin: 30px 0;
        }

        .master-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 25px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .master-btn:active {
            transform: scale(0.95);
        }

        .select-group {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            margin: 20px 0;
        }

        select, .action-btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }

        .action-btn {
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .action-btn:active {
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="homeScreen" class="screen active">
        <button class="master-btn" onclick="showMasterScreen()">üé® –ú–∞—Å—Ç–µ—Ä</button>
        
        <div class="header">
            <h1>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username">@username</span></h1>
        </div>

        <div class="select-group">
            <select id="citySelect">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                <option value="–í–æ—Ä–æ–Ω–µ–∂">–í–æ—Ä–æ–Ω–µ–∂</option>
                <option value="–°—Ç–∞—Ä—ã–π –û—Å–∫–æ–ª">–°—Ç–∞—Ä—ã–π –û—Å–∫–æ–ª</option>
                <option value="–ì—É–±–∫–∏–Ω">–ì—É–±–∫–∏–Ω</option>
                <option value="–ë–µ–ª–≥–æ—Ä–æ–¥">–ë–µ–ª–≥–æ—Ä–æ–¥</option>
            </select>
            
            <button class="action-btn" onclick="selectCity()">–í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏ -->
    <div id="serviceScreen" class="screen">
        <div class="select-group">
            <select id="serviceSelect">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</option>
                <option value="nails">üíÖ –ù–æ–≥—Ç–∏</option>
                <option value="lashes">üëÅÔ∏è –†–µ—Å–Ω–∏—Ü—ã</option>
                <option value="brows">‚úÇÔ∏è –ë—Ä–æ–≤–∏</option>
            </select>
            
            <button class="action-btn" onclick="selectService()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–ø–∏—Å–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ -->
    <div id="mastersScreen" class="screen">
        <div class="header">
            <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Å—Ç–µ—Ä–∞</h2>
            <p>üìç <span id="currentCity"></span> | üíº <span id="currentService"></span></p>
        </div>
        
        <div id="mastersList" class="select-group"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let currentCity = '';
        let currentService = '';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            tg.ready();
            tg.expand();
            loadUserData();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            try {
                const user = await fetch('/api/user-data');
                const data = await user.json();
                document.getElementById('username').textContent = `@${data.username}`;
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞
        function selectCity() {
            currentCity = document.getElementById('citySelect').value;
            if (!currentCity) return tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥');
            showScreen('serviceScreen');
        }

        // –í—ã–±–æ—Ä —É—Å–ª—É–≥–∏
        async function selectService() {
            currentService = document.getElementById('serviceSelect').value;
            if (!currentService) return tg.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É');
            
            try {
                const response = await fetch(`/api/masters?city=${currentCity}&service=${currentService}`);
                const masters = await response.json();
                
                document.getElementById('currentCity').textContent = currentCity;
                document.getElementById('currentService').textContent = 
                    document.querySelector(`#serviceSelect option[value="${currentService}"]`).textContent;
                
                renderMasters(masters);
                showScreen('mastersScreen');
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Å—Ç–µ—Ä–æ–≤');
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
        function renderMasters(masters) {
            const list = document.getElementById('mastersList');
            list.innerHTML = masters.map(master => `
                <div class="master-card">
                    <h3>${master.name}</h3>
                    <p>üí∞ ${master.price} —Ä—É–±. | ‚è± ${master.duration} –º–∏–Ω.</p>
                    <p>${master.bio}</p>
                </div>
            `).join('');
        }

        // –°—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
