<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BeautyBook</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #007bff;
            --secondary: #6c757d;
            --light: #f8f9fa;
            --dark: #343a40;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--light);
        }

        .screen {
            display: none;
        }

        .active {
            display: block !important;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .city-selector {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: white;
        }

        .master-btn {
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.2rem;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .master-btn:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="homeScreen" class="screen active">
        <div class="header">
            <h1>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BeautyBook!</h1>
        </div>

        <button class="master-btn" onclick="showMasterScreen()">
            üé® –í–æ–π—Ç–∏ –∫–∞–∫ –º–∞—Å—Ç–µ—Ä
        </button>

        <div class="city-selector">
            <select id="citySelect">
                <option value="–í–æ—Ä–æ–Ω–µ–∂">–í–æ—Ä–æ–Ω–µ–∂</option>
                <option value="–°—Ç–∞—Ä—ã–π –û—Å–∫–æ–ª">–°—Ç–∞—Ä—ã–π –û—Å–∫–æ–ª</option>
                <option value="–ì—É–±–∫–∏–Ω">–ì—É–±–∫–∏–Ω</option>
                <option value="–ë–µ–ª–≥–æ—Ä–æ–¥">–ë–µ–ª–≥–æ—Ä–æ–¥</option>
            </select>
            <button class="button" onclick="selectCity()">–í—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —É—Å–ª—É–≥–∏ -->
    <div id="serviceScreen" class="screen">
        <div class="header">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</h2>
        </div>
        
        <div class="service-list">
            <button class="service-btn" data-service="nails">üíÖ –ù–æ–≥—Ç–∏</button>
            <button class="service-btn" data-service="lashes">üëÅÔ∏è –†–µ—Å–Ω–∏—Ü—ã</button>
            <button class="service-btn" data-service="brows">‚úÇÔ∏è –ë—Ä–æ–≤–∏</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–ø–∏—Å–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤ -->
    <div id="mastersScreen" class="screen">
        <div class="header">
            <h2>–ú–∞—Å—Ç–µ—Ä–∞ –≤ <span id="currentCity"></span></h2>
            <p>–£—Å–ª—É–≥–∞: <span id="currentService"></span></p>
        </div>
        
        <div id="mastersList"></div>
    </div>

    <script>
        let currentCity = '';
        let currentService = '';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            tg.ready();
            tg.expand();
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
        function selectCity() {
            currentCity = document.getElementById('citySelect').value;
            showScreen('serviceScreen');
        }

        function selectService(service) {
            currentService = service;
            showScreen('mastersScreen');
            loadMasters();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
        async function loadMasters() {
            try {
                const response = await fetch(`/api/masters?city=${currentCity}&service=${currentService}`);
                const masters = await response.json();
                
                document.getElementById('currentCity').textContent = currentCity;
                document.getElementById('currentService').textContent = 
                    {nails: '–ù–æ–≥—Ç–∏', lashes: '–†–µ—Å–Ω–∏—Ü—ã', brows: '–ë—Ä–æ–≤–∏'}[currentService];
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
                const list = document.getElementById('mastersList');
                list.innerHTML = masters.map(m => `
                    <div class="master-card">
                        <h3>${m.name}</h3>
                        <p>–¶–µ–Ω–∞: ${m.price} —Ä—É–±.</p>
                    </div>
                `).join('');
                
            } catch (error) {
                tg.showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
